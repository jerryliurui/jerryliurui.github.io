---
layout: post
title: "iOS12 SiriShortcuté€‚é…å¼€å‘æ€»ç»“"
description: "iOS12 SiriShortcut"
category: iOS Programming
tags: [iOS12, Siri, Shortcut, Notification]
modified: 2018-11-11
imagefeature: bg/sirishortcutbg.png
comments: true
share: true
---

<section id="table-of-contents" class="toc">
<header>
<h1>Features</h1>
</header>
<div id="drawer" markdown="1">
*  Auto generated table of contents
{:toc}
</div>
</section><!-- /#table-of-contents -->

#### **0.å‰è¨€**
ä»Šå¹´æœ‰å¹¸å’ŒåŒäº‹ä¸€èµ·å‚åŠ äº†WWDC2018å¤§ä¼šï¼Œäºæ˜¯åœ¨å›æ¥ä¹‹åï¼Œè‡ªç„¶è€Œç„¶çš„éœ€è¦è¿›è¡Œå°é‡çš„æ±‡æŠ¥å·¥ä½œå’Œç»å†åˆ†äº«ã€‚æˆ‘è®°å¾—åœ¨æˆ‘çš„åˆ†äº«ä¸»é¢˜ä¸­ï¼Œç€é‡çš„ä»‹ç»äº†å…¶ä¸­æˆ‘è®¤ä¸ºæ¯”è¾ƒæœ‰ç”¨çš„ä¸”æœ€å¯èƒ½éœ€è¦é€‚é…çš„ä¸¤ä¸ªåŠŸèƒ½`Siri Shortcut`å’Œ`Group Notification`ã€‚

åœ¨åˆ†äº«ä¹‹åï¼ŒiOS12çš„é€‚é…å·¥ä½œä¹Ÿå¼€å§‹äº†ï¼Œäºæ˜¯å¾ˆè‡ªç„¶çš„è¿™ä¸ªæ´»å„¿åˆ°äº†æˆ‘çš„æ‰‹é‡Œ=ã€‚= ä»ç°åœ¨æ¥çœ‹ï¼Œè¿™çœŸçš„æ˜¯ä¸€æ®µå¼¥è¶³çè´µä¸”ååˆ†æ„Ÿäººçš„è¿‡ç¨‹ã€‚ç»ˆäºå¯ä»¥åä¸‹æ¥å¥½å¥½æ€»ç»“ä¸€ä¸‹è¿™æ®µæ—¶é—´çš„é€‚é…å·¥ä½œäº†ã€‚

#### **1.Group Notification**
> ç†æƒ³å¾ˆç¾å¥½ï¼Œç°å®å¾ˆæ®‹é…·

åˆ†ç»„é€šçŸ¥è®²é“ç†æ˜¯æˆ‘ä¸ªäººéå¸¸å–œæ¬¢çš„ä¸€ä¸ªæ›´æ–°ï¼Œç»ˆäºä¸ç”¨å†æ»‘é‚£ä¸€é¢ä¸€é¢çš„é€šçŸ¥äº†ï¼Œ`But`å¾ˆé—æ†¾ï¼Œæˆ‘ä»¬è¿˜æ˜¯èƒ½å¤Ÿé€šè¿‡æŸç§æ‰‹æ®µæ¥å®ç°ä¸åˆ†ç»„ä¸€æ¡ä¸€æ¡å±•ç¤ºçš„æ ·å­ã€‚ã€‚ã€‚åœ¨é€‚é…çš„æ—¶å€™ï¼Œæˆ‘ä¹Ÿæ›¾é—®è¿‡ç»„ç»‡ï¼Œè¿™ä¸ªåˆ†ç»„ï¼Œæ˜¯å¦æœ‰é™åˆ¶ï¼Ÿæˆ–è€…æ˜¯å¦æœ‰ä¸€ä¸ªæ¨¡ç³Šçš„é™åˆ¶ï¼Ÿç­”æ¡ˆä¹Ÿæ˜¯å«ç³Šçš„ï¼Œâ€œæ¨èâ€ä½¿ç”¨ä½ çš„appä¸­æ ¸å¿ƒçš„é€šçŸ¥åˆ†ç±»æ¥è¿›è¡Œåˆ†ç»„ã€‚ä¹Ÿå°±æ˜¯ç°åœ¨å½“`iOS12`æ­£å¼å‡ºæ¥ä¹‹åï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æŸä¹å•Šç­‰ä¸€äº›çš„appï¼Œæˆ‘ä»¬ä¼šæƒŠå–œçš„å‘ç°ï¼Œæˆ‘æ“¦å‹’ï¼Œç«Ÿç„¶æ˜¯ï¼š`â€˜One Notification,One Groupâ€™`.è®²é“ç†å†…å¿ƒæ˜¯æ‹’ç»çš„ï¼Œä½†æ˜¯æ¢ä¸ªè§’åº¦æ€è€ƒï¼Œæ˜¾ç„¶è¿™ä¹Ÿæ˜¯äº§å“å±‚é¢çš„å‹åŠ›å¯¼è‡´çš„é’»ç¯“å­ï¼Œæ‰“æ“¦è¾¹çƒäº†ã€‚

> å®ç°Group Notification

è¯´èµ·å®ç°ï¼Œå®¢æˆ·ç«¯æœ¬èº«ä¸€èˆ¬æ˜¯æ²¡æœ‰å·¥ä½œé‡çš„ï¼Œæ›´å¤šçš„æ˜¯appçš„pushåå°æ¥è¿›è¡Œç›¸åº”çš„å¼€å‘å’Œé€‚é…ã€‚åŸå› åœ¨äºå¦‚ä½•åˆ†ç»„çš„æœºåˆ¶ï¼Œæ˜¯é€šè¿‡å¢åŠ ä¸‰ä¸ªæ–°`key`æ¥å®ç°ã€‚åˆ†åˆ«æ˜¯:
* thread-id æ ‡è¯†åˆ†ç»„idï¼Œè¿™ä¸ªå­—æ®µç”¨æ¥ç³»ç»Ÿè¯†åˆ«åˆ†ç»„æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚â€œä½“è‚²â€â€œå¨±ä¹â€ç­‰
* summary-arg æ ‡è¯†ç›¸å…³è€…ï¼Œç³»ç»Ÿè¯†åˆ«æ¥æ˜¾ç¤ºé€šçŸ¥ä¸‹æ–¹ä¿¡æ¯æ¡ï¼Œä¾‹å¦‚ï¼šè¿˜æœ‰æ¥è‡ªâ€œæ¢…è¥¿â€çš„é€šçŸ¥
* summary-arg-count æ ‡è¯†ç›¸å…³è€…æ‰€å…³è”çš„é€šçŸ¥æ•°é‡ï¼Œä¾‹å¦‚ï¼šè¿˜æœ‰åä¸ªæ¥è‡ªâ€œæ¢…è¥¿â€é€šçŸ¥

{% highlight css %}
Playload æ ¼å¼ï¼š
{
"content-detail": "",
"attachment": "",
"aps": {
"badge": 1,
"alert": {
"title": "æ¢…è¥¿",
"body": "ä¼Šåˆ©ç‰¹çº¦ï¼šæˆªè‡³æœ¬æœˆ24æ—¥ï¼Œå¹³æ˜Œå†¬å¥¥å”®å‡º55.5ä¸‡å¼ é—¨ç¥¨ï¼Œé”€å”®ç‡ä¸º52%æ‰­è½¬é¢“åŠ¿ï¼Œå…¶ä¸­çŸ­é“èŠ±æ»‘éƒ¨åˆ†é—¨ç¥¨åŸºæœ¬å”®ç½„ã€‚",
"summary-arg": "æ¢…è¥¿",
"summary-arg-count": 5
},
"sound": "alert.wav",
"boardid": "",
"msgId": "",
"category": "",
"mutable-content": "1",
"thread-id": "notifications-team"
}
}

æ‰€æ·»åŠ ä½ç½®å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½ç½®é”™è¯¯ä¸ä¼šç”Ÿæ•ˆ

PS ç³»ç»Ÿä¼šä¼˜å…ˆæŒ‰ç…§thread-idæ¥åˆ†ç»„ï¼Œç„¶ååˆå¹¶æ‰€æœ‰åˆ†ç»„å†…çš„summary-arg å’Œ summary-arg-count
ä¾‹å¦‚ï¼šè¿˜æœ‰10ä¸ªæ¥è‡ªâ€œç§‘æ¯”å’ŒCç½—â€çš„é€šçŸ¥
{% endhighlight %}

#### **2.Siri Shortcut**

> Siriæ›´æ‡‚æ‰‹æœºå‰çš„ä½ ,æ‰‹æœºåæ˜¯ä¸€è„¸æ‡µé€¼çš„æˆ‘

è¿™ä¸ªåŠŸèƒ½å¤§æ¦‚æ˜¯`CarPlay`æ”¯æŒé«˜å¾·ç­‰ç¬¬ä¸‰æ–¹å¯¼èˆªä¹‹å¤–æ”¶è·æŒå£°æœ€å¤šçš„ä¸€ä¸ªæ–°åŠŸèƒ½äº†å§ã€‚æ—©å‰è‹¹æœæ”¶è´­äº†`workflow`å°±æˆ–å¤šæˆ–å°‘çš„é¢„æ„Ÿåˆ°`Siri+æ·å¾„`æ˜¯ä¸€æ¡å¾ˆç‚«é…·çš„è·¯çº¿ã€‚

å¯¹äºæˆ‘æ¥è¯´ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦`SiriKit`çš„ç›¸å…³å¼€å‘ï¼Œä¹‹å‰å¹¶æ²¡æœ‰æ¥è§¦è¿‡ï¼Œä¸è¿‡å…¶å®å¹¶ä¸å½±å“é€‚é…ä»»åŠ¡ï¼Œå¤§éƒ¨åˆ†åæ­£ä¹Ÿéƒ½æ˜¯åœ¨æ‘¸ç´¢ï¼Œå‘æ˜¯æŒºå¤šçš„ï¼Œä½†æ˜¯ç»“æœè¿˜ç®—æ»¡æ„ã€‚

##### (1)äº†è§£Siri Shortcutçš„æ•´ä¸ªè¡Œä¸º
æˆ‘ä»¬éœ€è¦å»åˆ›é€ ä¸€ä¸ªæ·å¾„ï¼Œé‚£é¦–å…ˆæˆ‘ä»¬å°±è¦å®šä¹‰è¿™ä¸ªæ·å¾„çš„å«ä¹‰ã€‚

å› ä¸ºè¿™ä¸ªæ–°åŠŸèƒ½æ˜¯è®©ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡`Siri`æ™ºèƒ½çš„çŒœæµ‹å‡ºä¸‹ä¸€æ­¥çš„è¡Œä¸ºå¹¶ç»™ä¸æç¤ºï¼Œæˆ–è€…ä¸€å¥è¯åšå®Œä¸€ä»¶æ›¾ç»éœ€è¦å¥½å‡ ä¸ªæ­¥éª¤çš„äº‹æƒ…ã€‚è€Œåœ¨æˆ‘éœ€è¦é€‚é…çš„appå†…ï¼Œç”±äºå®¢æˆ·ç«¯ç›®å‰çš„åŠŸèƒ½å·²ç»ååˆ†çš„ç¹å¤šï¼Œå› æ­¤ä¸ºä¸€äº›çƒ­é—¨åŠŸèƒ½ï¼Œå…¥å£åˆæ¯”è¾ƒæ·±çš„åŠŸèƒ½å®šä¹‰æ·å¾„å°±æ˜¾å¾—å¾ˆæœ‰å¿…è¦äº†ï¼Œè€Œä¸”ä½¿ç”¨åœºæ™¯ä¹Ÿéå¸¸çš„å¥‘åˆã€‚æƒ³æƒ³ä¸€ä¸‹ç”¨æˆ·å¯ä»¥é€šè¿‡å”¤é†’`Siri`æ¥ç›´æ¥æ‰“å¼€æŸäº›æ ç›®ï¼Œæˆ–è€…ç›´æ¥æ”¶å¬éŸ³é¢‘ï¼Œå²‚ä¸æ˜¯ç¾æ»‹æ»‹ã€‚

ä¸‹å›¾å…¶å®æ˜¯ä»å®è§‚ä¸Šæè¿°äº†ä¸€ä¸ªæ·å¾„çš„æ•´ä¸ª`Create`è¿‡ç¨‹
<figure>
<a href="{{ site.url }}/images/SiriShortcut/1.png"><img src="{{ site.url }}/images/SiriShortcut/1.png"></a>
</figure>

Create Shortcutæ‰€éœ€è¦çš„åª’ä»‹ï¼š
* 1.NSUserActivity
* 2.Intents
<figure>
<a href="{{ site.url }}/images/SiriShortcut/2.png"><img src="{{ site.url }}/images/SiriShortcut/2.png"></a>
</figure>

ä¹‹å‰å¦‚æœæœ‰å¼€å‘è¿‡`Handoff`åŠŸèƒ½çš„åŒå­¦ä¸€å®šä¸é™Œç”Ÿ`NSUserActivity`,é€šè¿‡å®ƒæ¥å®ç°Shortcutç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œå¯¹äºé‚£ç§éœ€è¦é€šè¿‡æ‰“å¼€å®¢æˆ·ç«¯æ¥å®Œæˆåç»­åŠ¨ä½œå’Œä»»åŠ¡çš„æ·å¾„æ¥è¯´å¾ˆåˆé€‚ã€‚è€Œ`Intents`è‹¹æœæ¨èçš„æ›´å¤šçš„æ˜¯ä¸éœ€è¦æ‰“å¼€å®¢æˆ·ç«¯çš„`Action`ã€‚æˆ‘åœ¨è¿™æ¬¡é€‚é…çš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ç»Ÿä¸€å’Œç»´æŠ¤ï¼Œåœ¨é€‚é…çš„ä¸‰ä¸ªæ·å¾„çš„å®ç°æ–¹å¼ä¸­ï¼Œéƒ½ä½¿ç”¨åˆ°çš„æ˜¯`Intents`æ¥å®ç°ï¼Œå› æ­¤åæ–‡ä¸»è¦ä»‹ç»è¿™ä¸ªæ–¹å¼çš„æ·å¾„è®¾è®¡å’Œå®ç°ã€‚

##### (2)å®šä¹‰Intent
åˆ›å»ºIntentå·¥ç¨‹æ–‡ä»¶ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/4.png"><img src="{{ site.url }}/images/SiriShortcut/4.png"></a>
</figure>

åœ¨ä¸‹å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»å†…ç½®äº†ä¸€éƒ¨åˆ†ç°æˆçš„Intentæ¥ä¾›æˆ‘ä»¬ä½¿ç”¨ï¼Œè¿™æ¬¡åœ¨demoä¸­å‡†å¤‡ä½¿ç”¨`Play Media Intent`æ¥å®ç°`Siri`å”¤èµ·å®¢æˆ·ç«¯éŸ³é¢‘è¿™ä¸ªåŠŸèƒ½ã€‚
<figure>
<a href="{{ site.url }}/images/SiriShortcut/5.png"><img src="{{ site.url }}/images/SiriShortcut/5.png"></a>
</figure>

é™¤äº†ä½¿ç”¨`Custom System Intent`ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰è‡ªå·±éœ€è¦çš„çº¯æ­£`Custom Intent`ã€‚å¦‚å›¾æˆ‘åˆ›å»ºäº†ä¸€ä¸ªæ‰“å¼€å¼¹çª—çš„æ„å›¾ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/6.png"><img src="{{ site.url }}/images/SiriShortcut/6.png"></a>
</figure>

åˆ°è¿™é‡Œï¼Œå®šä¹‰Intentå®¢æˆ·ç«¯æ–‡ä»¶çš„å·¥ä½œå°±å®Œæˆäº†ï¼Œå‡†å¤‡å¥½å‘Šè¯‰`Siri`äº†ã€‚

åœ¨`demo`ä¸­æˆ‘å®šä¹‰äº†ä¸€ä¸ªåŸºç¡€æ¨¡å‹ï¼Œæ¥å’Œæœªæ¥çš„ä¸šè§£è€¦`SiriShortcutIntentModel`,åªåŒ…å«ä¸¤ä¸ªå¿…å¤‡çš„å±æ€§:

{% highlight css %}
@interface SiriShortcutIntentModel : NSObject

/**
Intent title
*/
@property (nonatomic, copy) NSString *intentTitle;

/**
Intent SuggestedInvocationPhrase æ¨èçŸ­è¯­
*/
@property (nonatomic, copy) NSString *intentSuggestedInvocationPhrase;

@end
{% endhighlight %}

æ’­æ”¾éŸ³é¢‘çš„`SiriShortcutMediaItemModel`model:

{% highlight css %}
@interface SiriShortcutMediaItemModel : SiriShortcutIntentModel

/*
åª’ä½“æ ‡é¢˜
*/
@property (nonatomic, copy) NSString *mediaTitle;

/*
åª’ä½“çš„å°é¢å›¾URL
*/
@property (nonatomic, copy) NSString *mediaArtworkUrl;

/*
åª’ä½“Identifier
*/
@property (nonatomic, copy) NSString *mediaIdentifier;

@end
{% endhighlight %}

##### (3)Donate Intent
è‹¹æœè¿™é‡Œç”¨äº†ä¸€ä¸ªå¾ˆç”ŸåŠ¨çš„è¯å„¿`Donate`,ç›¸å½“äºç”¨æˆ·åœ¨è§¦å‘äº†ä¸Šæ–‡æˆ‘ä»¬å®šä¹‰çš„æ„å›¾çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ¥å‘Šè¯‰`Siri`ç”¨æˆ·è§¦å‘äº†è¿™ä¸ªæ„å›¾æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªæ„å›¾çš„å‚æ•°æ˜¯ä»€ä¹ˆï¼Œ`Siri`ä¼šæ ¹æ®ä½ çš„`Donate`ä¿¡æ¯æ¥æ­£ç¡®çš„åˆ¤æ–­å‡ºç”¨æˆ·æ„å›¾ï¼Œæ¥å……åˆ†çš„é¢„æµ‹ä¸‹ä¸€æ¬¡æƒ³è¦è¿›è¡Œè¿™ä¸ªæ„å›¾çš„æ—¶é—´ï¼Œ`Donate`è¶Šå……åˆ†ï¼Œè¿™ä¸ªé¢„æµ‹æ¨¡å‹å°±è¶Šå¼ºå£®ï¼Œå½“ç„¶è¿™é‡Œä¹Ÿä¸ç”¨æ‹…å¿ƒç”¨æˆ·éšç§æ•°æ®çš„é—®é¢˜ï¼Œè‹¹æœå¯åå¤çš„åœ¨æ‰¿è¯ºè¿™æ˜¯ä¸€ä¸ªæœ¬åœ°ç”¨æˆ·æ¨¡å‹çš„åˆ›å»ºå’Œæ¨¡æ‹Ÿã€‚

å½“ç„¶è¿™ä¸ª`Donate`çš„æ—¶æœºä¹Ÿå¾ˆé‡è¦ï¼Œç”¨è‹¹æœçš„è¯å«åšçœŸæ­£è¦å‘Šè¯‰`Siri`çš„æ—¶å€™å†å‘Šè¯‰ï¼Œä¸è¦æ»¥ç”¨ã€‚è™½ç„¶â€œæ»¥ç”¨â€çœ‹ä¸Šå»è²Œä¼¼æ²¡æœ‰ä»€ä¹ˆè‡´å‘½çš„æˆ–è€…éæ³•çš„å½±å“=ã€‚=

`Demo`ä¸­ç®€å•çš„å°†`Donate`æ—¶æœºæ”¾åœ¨äº†ç¨‹åºå¯åŠ¨çš„æ—¶å€™ã€‚

###### (3.1)è´¡çŒ®Intentçš„æ–¹æ³•å½¢å¦‚ï¼š

{% highlight css %}
+ (void)donateTrackNewsIntentWith:(NSArray<SiriShortcutMediaItemModel *> *)tracks {}
{% endhighlight %}

###### (3.2)åˆ›å»º`INPlayMediaIntent`ï¼š

{% highlight css %}
INPlayMediaIntent *playIntent = [[INPlayMediaIntent alloc] initWithMediaItems:mediaIntents mediaContainer:container playShuffled:[NSNumber numberWithBool:NO] playbackRepeatMode:INPlaybackRepeatModeAll resumePlayback:@(0)];
{% endhighlight %}

`initWithMediaItems`å¯ä»¥ç†è§£ä¸“è¾‘å†…çš„æ­Œæ›²ä»¬ï¼Œ`mediaContainer`ç†è§£ä¸ºä¸“è¾‘åç§°ã€‚

###### (3.3)ç„¶åå®ç°`Donate`ç³»ç»Ÿæ–¹æ³•ï¼š

{% highlight css %}
INInteraction *interaction = [[INInteraction alloc] initWithIntent:playIntent response:nil];
if (interaction) {
[interaction donateInteractionWithCompletion:^(NSError * _Nullable error) {
if (error) {
}
}];
};
{% endhighlight %}

åˆ°è¿™é‡Œæˆ‘ä»¬ç†è®ºä¸Šå°±å·²ç»å‘Šè¯‰ç³»ç»Ÿç”¨æˆ·è¿™ä¸ªæ„å›¾äº†ï¼Œ`Siri`å°±ä¼šçŸ¥é“ï¼Œå“¦ï¼Œè¿™ä¸ªæ—¶é—´ï¼Œç”¨æˆ·æ’­æ”¾äº†XXXæ­Œå•é‡Œè¾¹çš„XXXæ­Œæ›²ä»¬äº†ã€‚


##### (4)Handle Intent
è´¡çŒ®ä¸Šå»çš„`Intent`çœ‹ä¼¼æ˜¯æ— å½¢çš„ï¼Œå¯¹äºæˆ‘ä»¬å¼€å‘é˜¶æ®µæ¥è¯´éœ€è¦å¤§æ¦‚ç‡çš„çœ‹åˆ°è‡ªå·±è´¡çŒ®å‡ºå»çš„æ„å›¾ï¼Œ`Siri`ä¼šå¦‚ä½•çš„å±•ç°ç»™ç”¨æˆ·ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥é€šè¿‡ä¸‹è¾¹çš„è®¾ç½®æ¥è¾¾åˆ°ç›®çš„ `æ‰‹æœºè®¾ç½®`-`å¼€å‘è€…`ä¸­æ‰“å¼€å¦‚å›¾å‡ ä¸ªé€‰é¡¹ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/7.png"><img src="{{ site.url }}/images/SiriShortcut/7.png"></a>
</figure>

è¿™ä¹ˆä¸€é¡¿æ“ä½œä¹‹åï¼Œå°±å¯ä»¥åœ¨`é”å±`æˆ–è€…`spotlight`é‡Œè¾¹è½»æ¾çš„å‘ç°æˆ‘ä»¬è´¡çŒ®è¿‡çš„`Intent`äº†ï¼Œä»è€Œå¿«é€Ÿçš„è”è°ƒå’Œå¼€å‘ã€‚
<figure>
<a href="{{ site.url }}/images/SiriShortcut/8.png"><img src="{{ site.url }}/images/SiriShortcut/8.png"></a>
</figure>

å½“ç„¶è¿™ä¸ªæ—¶å€™ç‚¹å‡»æ’­æ”¾æŒ‰é’®æˆ–è€…æ•´æ¡çš„`Siri`æ¨èéƒ½æ˜¯ç›´æ¥æ‰“å¼€å®¢æˆ·ç«¯çš„ï¼Œå¹¶ä¸”æ˜¯è¿›å…¥åˆ°é¦–é¡µä»€ä¹ˆäº‹å„¿éƒ½ä¸ä¼šåšçš„ï¼Œé‚£æ˜¯å› ä¸ºè¿˜æ²¡æœ‰å»`Handle Intent`ã€‚è¿™é‡Œå°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰çš„`CustomIntentUI`å’Œ`CustomIntent`äº†ã€‚

###### (4.1)æ–°å»ºä¸¤ä¸ªTargetï¼š

<figure>
<a href="{{ site.url }}/images/SiriShortcut/9.png"><img src="{{ site.url }}/images/SiriShortcut/9.png"></a>
</figure>

* CustomIntentUIï¼šè´Ÿè´£è‡ªå®šä¹‰çš„Siriåé¦ˆUIæ˜¾ç¤ºçš„
* CustomIntentï¼šè´Ÿè´£è‡ªå®šä¹‰çš„Intent Handle

###### (4.2)Custom Intentï¼š

åœ¨CustomIntentä¸­ï¼Œéœ€è¦å®ç°çš„æ˜¯`INPlayMediaIntentHandling`åè®®
å½“ç„¶ä¸åŒçš„å†…ç½®`Intent`æ˜¯éœ€è¦å®ç°ä¸åŒçš„åè®®çš„ï¼Œå½“æˆ‘ä»¬æ–°å»ºä¸€ä¸ª`Custom Intent`æ¨¡æ¿è‡ªå¸¦çš„å°±æ˜¯ä¿¡æ¯çš„å†…ç½®`Intent`ä»¥åŠä»–çš„åè®®ï¼š

{% highlight css %}
- (void)handlePlayMedia:(INPlayMediaIntent *)intent
completion:(void (^)(INPlayMediaIntentResponse *response))completion NS_SWIFT_NAME(handle(intent:completion:));
{% endhighlight %}

å›è°ƒè¿”å›ï¼š

{% highlight css %}
INPlayMediaIntentResponse *response = [[INPlayMediaIntentResponse alloc] initWithCode:INPlayMediaIntentResponseCodeHandleInApp userActivity:nil];
completion(response);
{% endhighlight %}

è¿™é‡Œä½¿ç”¨çš„æ˜¯éœ€è¦åœ¨ä¸»å®¢æˆ·ç«¯å¤„ç†ï¼Œå› ä¸ºä¸€å®šçš„å®¢è§‚åŸå› ï¼Œå®é™…å·¥ä½œå·¥ç¨‹æš‚æ—¶è¿˜æ²¡æœ‰`sharegroup`çš„å†…å®¹ï¼Œå› æ­¤è¯·æ±‚ç½‘ç»œã€æ’­æ”¾éŸ³é¢‘ç­‰æ“ä½œï¼Œè¿˜æ˜¯è¦äº¤ç»™ä¸»å®¢æˆ·ç«¯ï¼Œå¦‚æœä½ çš„appè¿™æ–¹é¢å¾ˆæˆç†Ÿäº†ï¼Œå°±å¯ä»¥ä¸è¿™ä¹ˆåšäº†ã€‚

ç”±äºæˆ‘ä»¬éœ€è¦ä¸»å®¢æˆ·ç«¯æ¥å¤„ç†`Intent`çš„ç›¸åº”ï¼Œå› æ­¤åœ¨ä¸»å®¢æˆ·ç«¯çš„`App Delegate`ä¸­è¿˜éœ€è¦é¢å¤–çš„æ“ä½œï¼Œå®ç°ä¸‹é¢çš„è¿™ä¸ªä»£ç†æ–¹æ³•ï¼Œå¦åˆ™æ˜¯æ— æ³•æ­£ç¡®å¤„ç†çš„ï¼š

{% highlight css %}
- (void)application:(UIApplication *)application handleIntent:(INIntent *)intent completionHandler:(void (^)(INIntentResponse *intentResponse))completionHandler;
{% endhighlight %}

åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œ`INPlayMediaIntent`è§£æï¼Œå¹¶è¿›è¡Œç½‘ç»œè¯·æ±‚æ¥æ’­æ”¾æœ€æ–°ä¸€æœŸçš„éŸ³é¢‘ç­‰ï¼Œæœ€ååœ¨å›è°ƒä¸­è®°å¾—å‘Šè¯‰Siriå¤„ç†æˆåŠŸä¸å¦ï¼š

{% highlight css %}
INPlayMediaIntentResponse *successResponse = [[INPlayMediaIntentResponse alloc] initWithCode:INPlayMediaIntentResponseCodeSuccess userActivity:nil];
completionHandler(successResponse);
{% endhighlight %}

###### (4.3)Custom Intent UIï¼š

> Prepare your view controller for the interaction to handle.

åˆ°è¿™é‡Œï¼Œå®Œæ•´çš„`INPlayMediaIntent`åˆ›å»ºå’Œåé¦ˆåŸºæœ¬ä¸Šéƒ½åšå¥½äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯è‡ªå®šä¹‰çš„UIäº†ï¼Œé»˜è®¤å¦‚æœæˆ‘ä»¬ä¸æ–°å»º`Custom Intent UI`çš„è¯ï¼Œç³»ç»Ÿä¼šç»™ä¸€ä¸ªé»˜è®¤çš„ä¿¡æ¯é¢æ¿ç»™ç”¨æˆ·ä¸€ä¸ªåº”ç”¨icon+Title+subTitleï¼Œç»„åˆæ–¹å¼æ ¹æ®`Intent`å‚æ•°æ¥ï¼Œå¾ˆçµæ´»ã€‚ä¸»è¦çš„è‡ªå®šä¹‰UIçš„ä»£ç å†™åœ¨è¿™é‡Œï¼š

{% highlight css %}
- (void)configureViewForParameters:(NSSet <INParameter *> *)parameters ofInteraction:(INInteraction *)interaction interactiveBehavior:(INUIInteractiveBehavior)interactiveBehavior context:(INUIHostedViewContext)context completion:(void (^)(BOOL success, NSSet <INParameter *> *configuredParameters, CGSize desiredSize))completion API_AVAILABLE(ios(11.0));
{% endhighlight %}

ç”Ÿå‘½å‘¨æœŸåœ¨æ•´ä¸ª`Intent`å“åº”æœŸé—´ï¼Œå› æ­¤ä¼šå¤šæ¬¡è°ƒç”¨ä¸Šé¢è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ç»™çš„å½“å‰çŠ¶æ€æ¥é…ç½®ç›¸åº”çš„UIã€‚çŠ¶æ€çš„è·å–:`interaction.intentHandlingStatus`ã€‚æœ€åå›è°ƒä¸­é…ç½®æ¯ä¸€æ¬¡çŠ¶æ€çš„UIé«˜åº¦ï¼š

{% highlight css %}
if (completion) {
completion(YES, parameters, CGSizeMake([self extensionContext].hostedViewMaximumAllowedSize.width, 80));
}
{% endhighlight %}

###### (4.4)Bug Reporter 1ï¼š
è¿™é‡Œé¡ºå¸¦æåˆ°äº†ä¸€ä¸ªå·²çŸ¥çš„é—®é¢˜ï¼Œå·²ç»æäº¤äº†Radarï¼Œç¼–å·ï¼š44375523ï¼Œé—®é¢˜æè¿°:

{% highlight css %}
Summary:
CutsomIntentUI can not receive intentHandlingStatusSuccess status when play mediaIntent via SiriUI.
But It is weired when I triggle playing media intent via spotlight, my CutsomIntentUI can receive intentHandlingStatusSuccess after I click play button.
{% endhighlight %}

æ¦‚æ‹¬æ¥è¯´å°±æ˜¯å½“ä½¿ç”¨`Siri`æ¥å”¤èµ·UIçš„æ—¶å€™ï¼Œä¼šæ”¶ä¸åˆ°`intentHandlingStatusSuccess`çŠ¶æ€=ã€‚=
è¿™æ ·çš„é—®é¢˜å°±æ˜¯ä¼šé€ æˆä¸åŒåœºæ™¯ä¸‹`Custom UI`ååº”ä¸ä¸€è‡´ï¼Œæˆªæ­¢åˆ°ç›®å‰æ¥çœ‹ï¼Œæ–°çš„Beta SDKä¾ç„¶æ²¡æœ‰è§£å†³æ‰è¿™ä¸ªé—®é¢˜ã€‚

#### **3.æ–°ç»„ä»¶**

##### (1)ï¼šINUIAddVoiceShortcutButton

è¿™æ˜¯ä¸€ä¸ªèˆ¹æ–°æ§ä»¶ï¼Œç»‘å®š`Intent`å¯ä»¥ç›´æ¥åœ¨ç‚¹å‡»ä¸­å‡ºç°æ·»åŠ `ShortCut`çš„ç»„ä»¶ï¼Œç”±äºæ˜¯è‹¹æœè‡ªå·±çš„æ§ä»¶ï¼Œå› æ­¤å¾ˆæ¨èä½¿ç”¨è¿™ä¸ªæŒ‰é’®ã€‚

###### (1.1)åˆ›å»ºINUIAddVoiceShortcutButton

{% highlight css %}
- (INUIAddVoiceShortcutButton *)addToSiriBtn  API_AVAILABLE(ios(12.0)){
if (!_addToSiriBtn) {
_addToSiriBtn = [[INUIAddVoiceShortcutButton alloc] initWithStyle:INUIAddVoiceShortcutButtonStyleBlack];
INIntent *intentItem = XXX;
INShortcut *shortCut = [[INShortcut alloc] initWithIntent:intentItem];
_addToSiriBtn.delegate = self;
_addToSiriBtn.translatesAutoresizingMaskIntoConstraints = NO;
[_addToSiriBtn setShortcut:shortCut];
}

return _addToSiriBtn;
}
{% endhighlight %}

æ ·å¼æœ‰å››ç§ï¼š

{% highlight css %}
typedef NS_ENUM(NSUInteger, INUIAddVoiceShortcutButtonStyle) {
INUIAddVoiceShortcutButtonStyleWhite = 0,
INUIAddVoiceShortcutButtonStyleWhiteOutline,
INUIAddVoiceShortcutButtonStyleBlack,
INUIAddVoiceShortcutButtonStyleBlackOutline
} API_AVAILABLE(ios(12.0)) API_UNAVAILABLE(watchos, macosx, tvos);
{% endhighlight %}

demoä¸­æœ‰ç½—åˆ—ï¼Œåªç®¡çœ‹ä¸Šå»å°±æ˜¯ä¸‹å›¾çš„æ ·å­ï¼Œç¬¬ä¸€ä¸ªæ²¡æœ‰è¾¹æ¡†ï¼Œå’ŒèƒŒæ™¯è‰²ç™½è‰²é‡å ï¼Œæœ€åä¸€ä¸ªçœ‹ä¸åˆ°è¾¹æ¡†æ˜¯å†…éƒ¨çš„é»‘è‰²å’Œè¾¹æ¡†è§†è§‰ä¸Šå¾ˆéš¾åˆ†æ¸…ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/10.png"><img src="{{ site.url }}/images/SiriShortcut/10.png"></a>
</figure>

###### (1.2)å®ç°INUIAddVoiceShortcutButtonDelegate

åè®®å¯ä»¥åšçš„äº‹æƒ…å…¶å®å°±ä¸¤ç§ï¼š
* present Add Voice ShortcutVC
* present Edit Voice ShortcutVC

{% highlight css %}
- (void)presentAddVoiceShortcutViewController:(nonnull INUIAddVoiceShortcutViewController *)addVoiceShortcutViewController forAddVoiceShortcutButton:(nonnull INUIAddVoiceShortcutButton *)addVoiceShortcutButton  API_AVAILABLE(ios(12.0)){
if (addVoiceShortcutButton && addVoiceShortcutButton.shortcut && addVoiceShortcutViewController) {
addVoiceShortcutViewController.delegate = self;
[GetRootNavigation() presentViewController:addVoiceShortcutViewController animated:YES completion:nil];
}
}

- (void)presentEditVoiceShortcutViewController:(nonnull INUIEditVoiceShortcutViewController *)editVoiceShortcutViewController forAddVoiceShortcutButton:(nonnull INUIAddVoiceShortcutButton *)addVoiceShortcutButton  API_AVAILABLE(ios(12.0)){
if (addVoiceShortcutButton && addVoiceShortcutButton.shortcut && editVoiceShortcutViewController) {
editVoiceShortcutViewController.delegate = self;
[GetRootNavigation() presentViewController:editVoiceShortcutViewController animated:YES completion:nil];
}
}
{% endhighlight %}

###### (1.3)æœ¬åœ°åŒ–

åœ¨è‡ªå·±å·¥ç¨‹å†…æœ¬åœ°åŒ–æ–‡ä»¶ä¸­ç›¸åº”çš„æ·»åŠ å¯¹åº”å­—ç¬¦ä¸²å°±å¯ä»¥äº†ã€‚è‹¹æœç»™çš„æœ¬åœ°åŒ–æ¨èå­—ç¬¦ä¸²å¦‚ä¸‹ï¼š

{% highlight css %}
ar:
"Add to Siri" = "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Siri";
"Added to Siri" = "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Siri";

ca:
"Add to Siri" = "Afegir a Siri";
"Added to Siri" = "Afegit a Siri";

cs:
"Add to Siri" = "PÅ™idat do Siri";
"Added to Siri" = "PÅ™idÃ¡no do Siri";

da:
"Add to Siri" = "FÃ¸j til Siri";
"Added to Siri" = "FÃ¸jet til Siri";

de:
"Add to Siri" = "Zu Siri hinzufÃ¼gen";
"Added to Siri" = "Zu Siri hinzugefÃ¼gt";

el:
"Add to Siri" = "Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· ÏƒÏ„Î¿ Siri";
"Added to Siri" = "Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ ÏƒÏ„Î¿ Siri";

en:
"Add to Siri" = "Add to Siri";
"Added to Siri" = "Added to Siri";

en_AU:
"Add to Siri" = "Add to Siri";
"Added to Siri" = "Added to Siri";

en_GB:
"Add to Siri" = "Add to Siri";
"Added to Siri" = "Added to Siri";

es:
"Add to Siri" = "AÃ±adir a Siri";
"Added to Siri" = "AÃ±adido a Siri";

es_419
"Add to Siri" = "Agregar a Siri";
"Added to Siri" = "Se agregÃ³ a Siri";

fi:
"Add to Siri" = "LisÃ¤Ã¤ Siriin";
"Added to Siri" = "LisÃ¤tty Siriin";

fr:
"Add to Siri" = "Ajouter Ã  Siri";
"Added to Siri" = "AjoutÃ© Ã  Siri";

fr_CA:
"Add to Siri" = "Ajouter Ã  Siri";
"Added to Siri" = "AjoutÃ© Ã  Siri";

he:
"Add to Siri" = "×”×•×¡×£ ×œ-Siri";
"Added to Siri" = "× ×•×¡×£ ×œ-Siri";

hi:
"Add to Siri" = "Siri à¤®à¥‡à¤‚ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚";
"Added to Siri" = "Siri à¤®à¥‡à¤‚ à¤œà¥‹à¤¡à¤¼à¤¾ à¤—à¤¯à¤¾";

hr:
"Add to Siri" = "Dodaj u Siri";
"Added to Siri" = "Dodano u Siri";

hu:
"Add to Siri" = "HozzÃ¡adÃ¡s a Sirihez";
"Added to Siri" = "HozzÃ¡adva a Sirihez";

id:
"Add to Siri" = "Tambahkan ke Siri";
"Added to Siri" = "Ditambahkan ke Siri";

it:
"Add to Siri" = "Aggiungi su Siri";
"Added to Siri" = "Aggiunto su Siri";

ja:
"Add to Siri" = "Siriã«è¿½åŠ ";
"Added to Siri" = "Siriã«è¿½åŠ æ¸ˆã¿";

ko:
"Add to Siri" = "Siriì— ì¶”ê°€";
"Added to Siri" = "Siriì— ì¶”ê°€ë¨";

ms:
"Add to Siri" = "Tambah ke Siri";
"Added to Siri" = "Ditambah ke Siri";

nl:
"Add to Siri" = "Voeg toe aan Siri";
"Added to Siri" = "Toegevoegd aan Siri";

no:
"Add to Siri" = "Legg til i Siri";
"Added to Siri" = "Lagt til i Siri";

pl:
"Add to Siri" = "Dodaj do Siri";
"Added to Siri" = "Dodano do Siri";

pt:
"Add to Siri" = "Adicionar Ã  Siri";
"Added to Siri" = "Adicionado Ã  Siri";

pt_PT:
"Add to Siri" = "Adicionar a Siri";
"Added to Siri" = "Adicionado a Siri";

ro:
"Add to Siri" = "AdÄƒugaÈ›i la Siri";
"Added to Siri" = "AdÄƒugatÄƒ la Siri";

ru:
"Add to Siri" = "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´Ğ»Ñ Siri";
"Added to Siri" = "Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ Ğ´Ğ»Ñ Siri";

sk:
"Add to Siri" = "PridaÅ¥ do Siri";
"Added to Siri" = "PridanÃ© do Siri";

sv:
"Add to Siri" = "LÃ¤gg till i Siri";
"Added to Siri" = "Lades till i Siri";

th:
"Add to Siri" = "à¹€à¸à¸´à¹ˆà¸¡à¹„à¸›à¸¢à¸±à¸‡ Siri";
"Added to Siri" = "à¹€à¸à¸´à¹ˆà¸¡à¹„à¸›à¸¢à¸±à¸‡ Siri à¹à¸¥à¹‰à¸§";

tr:
"Add to Siri" = "Siriâ€™ye Ekle";
"Added to Siri" = "Siriâ€™ye Eklendi";

uk:
"Add to Siri" = "Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ Ğ´Ğ¾ Siri";
"Added to Siri" = "Ğ”Ğ¾Ğ´Ğ°Ğ½Ğ¾ Ğ´Ğ¾ Siri";

vi:
"Add to Siri" = "ThÃªm vÃ o Siri";
"Added to Siri" = "ÄÃ£ thÃªm vÃ o Siri";

zh_CN:
"Add to Siri" = "æ·»åŠ åˆ° Siri";
"Added to Siri" = "å·²æ·»åŠ åˆ° Siri";

zh_HK:
"Add to Siri" = "åŠ è‡³ Siri";
"Added to Siri" = "å·²åŠ è‡³ Siri";

zh_TW:
"Add to Siri" = "åŠ å…¥ Siri";
"Added to Siri" = "å·²åŠ å…¥ Siri";
{% endhighlight %}

##### (2)ï¼šINUIAddVoiceShortcutViewController
è¿™ä¸ªæ–°å‡ºçš„VCå’Œåœ¨`iPhone-è®¾ç½®-Siri`ä¸­æ·»åŠ `Shortcut`çš„é¡µé¢ä¸€è‡´ï¼Œè¾…åŠ©å®¢æˆ·ç«¯å¯ä»¥åœ¨å†…éƒ¨å°±å¯ä»¥å”¤èµ·ï¼Œå¹¶ç›´æ¥æ·»åŠ ç›¸å…³çš„è¯­éŸ³æ·å¾„ï¼Œä¸éœ€è¦ç”¨æˆ·å†è·³å»è®¾ç½®é¡µé¢ï¼Œè¿™æ ·ç”¨æˆ·å°±å¯ä»¥åœ¨æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯å†…å®¹ä¸­æ–¹ä¾¿çš„æ·»åŠ ã€‚

è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ä¸€å®šè¦å®ç°`Delegate`å¦åˆ™æ·»åŠ å®Œè¯­éŸ³ï¼Œæ— è®ºæ˜¯`Done`è¿˜æ˜¯`Cancel`éƒ½ä¼šå´©æºƒï¼š

{% highlight css %}
/*!
å®Œæˆæ·»åŠ 
*/
- (void)addVoiceShortcutViewController:(INUIAddVoiceShortcutViewController *)controller didFinishWithVoiceShortcut:(nullable INVoiceShortcut *)voiceShortcut error:(nullable NSError *)error;

/*!
å–æ¶ˆæ·»åŠ 
*/
- (void)addVoiceShortcutViewControllerDidCancel:(INUIAddVoiceShortcutViewController *)controller;
{% endhighlight %}

è€Œä¸”è¿™ä¸ªå†…ç½®é¡µæ˜¯ä¸ä¼šéšç€ç”¨æˆ·çš„äº¤äº’è‡ªå·±æ¶ˆå¤±çš„ï¼Œéœ€è¦è‡ªå·±åœ¨ä»£ç†å›è°ƒä¸­`dismiss`æ‰ã€‚

##### (3)ï¼šINUIEditVoiceShortcutViewController
ç¼–è¾‘VCå’Œæ·»åŠ VCå¾ˆåƒï¼Œä¸åŒçš„æ˜¯å®ç°çš„ä»£ç†ä¸åŒï¼Œéœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚

æˆ‘ä»¬ä»¥ç‚¹å‡»ç¬¬äºŒä¸ª`Add To Siri`æŒ‰é’®ä¸ºä¾‹ï¼š
ç‚¹å‡»æ·»åŠ ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/11.png"><img src="{{ site.url }}/images/SiriShortcut/11.png"></a>
</figure>

æ·»åŠ å®Œæˆä¹‹åæŒ‰é’®å˜åŒ–ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/12.png"><img src="{{ site.url }}/images/SiriShortcut/12.png"></a>
</figure>

ç‚¹å‡»æ·»åŠ è¿‡çš„æŒ‰é’®ï¼Œå‡ºç¼–è¾‘VC:
<figure>
<a href="{{ site.url }}/images/SiriShortcut/13.png"><img src="{{ site.url }}/images/SiriShortcut/13.png"></a>
</figure>


#### **4.æ”¯æŒSiri Watch Face**
è¿™å°±éœ€è¦å¦ä¸€ä¸ª`Shortcut`æ¥å®ç°äº†ï¼š`INRelevantShortcut`
æˆ‘ä»¬åœ¨è´¡çŒ®è¿™ä¸ª`Shortcut`çš„æ—¶å€™å¯ä»¥ç»™ç³»ç»Ÿå‚è€ƒçš„ä¸œè¥¿æ¯”è¾ƒä¸°å¯Œäº†ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸åŒçš„`Provider`ï¼Œä¾‹å¦‚åœ°ç‚¹çš„ã€æ—¶é—´çš„ç”šè‡³æ˜¯æ—¥å¸¸æ´»åŠ¨çš„ï¼Œè¿™ä¸ªä¸œè¥¿ç†è§£èµ·æ¥æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ–è€…è¯´æ¯”è¾ƒæœºå™¨ã€‚

* INDateRelevanceProvider ç”¨æˆ·æ¯å‘¨å››éƒ½ä¼šä¹°ä¸€æœ¬ä½“å›å‘¨åˆŠï¼Œè¿™ä¸ªå‘¨å››ï¼Œå°±å¯ä»¥ä½œä¸ºä¸€ä¸ªç»´åº¦æ¥ç»™siriæ¥é¢„æµ‹
* INLocationRelevanceProvider ç”¨æˆ·æ¯æ¬¡åˆ°åŒ—äº¬ï¼Œéƒ½æ˜¯æ¥å‡ºå·®çš„ï¼Œè¿™ç§caseå°±å¯ä»¥å°†åŒ—äº¬ä¼ ç»™ç³»ç»Ÿ
* INDailyRoutineRelevanceProvider è¿™ä¸ªæˆ‘è§‰å¾—æ˜¯åº”ç”¨åœºæ™¯æœ€å¤šçš„äº†ä¸€ä¸ªäº†ï¼Œæˆ‘åœ¨å·¥ç¨‹é€‚é…çš„æ—¶å€™ä½¿ç”¨çš„æ˜¯`INDailyRoutineSituationMorning`æ³¨æ„è¿™é‡Œçš„æ—©ä¸­æ™šå•Šå¹¶ä¸æ˜¯æ—¶åŒºä¸Šçš„æ—©ä¸­æ™šï¼Œè€Œæ˜¯é’ˆå¯¹è¿™ä¸ªæ‰‹æœºå‰çš„äººæ¥è®²ï¼Œæ¯”å¦‚æˆ‘å¯èƒ½æ¯å¤©åç‚¹åŠæ‰èµ·åºŠï¼Œé‚£åç‚¹åŠå°±æ˜¯æˆ‘çš„`INDailyRoutineSituationMorning`

æˆ‘ä»¬è¿˜å¯ä»¥å®šåˆ¶`Siri watch face`çš„æ ·å¼ï¼Œè¿™ä¸ªå’Œ`Custom Intent UI`å¾ˆç±»ä¼¼ï¼Œå¦‚æœæˆ‘ä»¬ä¸è®¾ç½®çš„è¯ï¼Œç³»ç»Ÿä¼šç»™æˆ‘ä»¬ä¸€ä¸ªæ¨¡æ¿æ¥å±•ç¤ºã€‚

{% highlight css %}
//è‡ªå®šä¹‰è¡¨ç›˜æ˜¾ç¤ºå†…å®¹
INDefaultCardTemplate *cardTemplate = [[INDefaultCardTemplate alloc] initWithTitle:kSiriRelevantShortcutCardTemplateTitle];
cardTemplate.subtitle = kSiriRelevantShortcutCardTemplateSubTitle;
cardTemplate.image = [INImage imageNamed:@"sirishortcut_relax_artwork"];
[relevantShortcut setWatchTemplate:cardTemplate];
{% endhighlight %}

æœ€åè®¾ç½®åˆ°`INRelevantShortcutStore` ä¸‡äº‹å¤§å‰ï¼š

{% highlight css %}
[[INRelevantShortcutStore defaultStore] setRelevantShortcuts:@[relevantShortcut] completionHandler:^(NSError * _Nullable error) {}];
{% endhighlight %}

#### **5.å…¶ä»–æ¯”è¾ƒæœ‰ç”¨çš„Tips**

##### (1)ï¼šè·å–å½“å‰Appæ·»åŠ çš„æ‰€æœ‰Siri æ·å¾„

`INVoiceShortcutCenter`æä¾›äº†ä¸€ä¸ªæ–¹æ³•ç»™æˆ‘ä»¬æ¥è·å–å½“å‰`App`ä¸€å…±æ·»åŠ äº†å¤šå°‘æ¡`Siri`è¯­éŸ³æ·å¾„:

{% highlight css %}
[[INVoiceShortcutCenter sharedCenter] getAllVoiceShortcutsWithCompletion:^(NSArray<INVoiceShortcut *> * _Nullable voiceShortcuts, NSError * _Nullable error) {
if(handler) {
handler(voiceShortcuts,error);
}
}];
{% endhighlight %}

`handler` :

{% highlight css %}
typedef void(^NTESNBGetAllVoiceShortCutCompletionHandler)(NSArray<INVoiceShortcut *> * _Nullable voiceShortcuts,NSError * _Nullable error);
{% endhighlight %}

æˆ‘ä»¬é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥é—´æ¥çš„è·å–æˆ‘ä»¬æŸä¸€ä¸ª`Intent`çš„è¯­éŸ³æ·å¾„æ¡æ•°äº†,æˆ–è€…åˆ¤æ–­æŸä¸€ä¸ª`Intent`æ˜¯å¦è¢«ç”¨æˆ·æ·»åŠ è¿‡ç›¸å…³çš„è¯­éŸ³æ·å¾„ï¼š

{% highlight css %}
for (INVoiceShortcut *voiceShortcut in voiceShortcuts) {
INIntent *intent = voiceShortcut.shortcut.intent;
if([intent isKindOfClass:[XXXXIntent class]]) {
completionHandler(YES);
return;
}
}
{% endhighlight %}

##### (2)ï¼šæœ¬åœ°åŒ–

é€‚é…ç‰ˆæœ¬çš„å‰å‡ ä¸ªç‰ˆæœ¬æäº¤å®¡æ ¸å‰çš„æ‰“åŒ…ä¸Šä¼ è¿™ä¸€æ­¥åšå®Œä¹‹åï¼Œæ€»æ˜¯ä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯æˆ‘ä»¬æ‰€å®šä¹‰çš„`Custom Intent`æ²¡æœ‰è¿›è¡Œæœ¬åœ°åŒ–ï¼Œè™½ç„¶ä¸ä¼šå½±å“æš‚æ—¶çš„æ‰“åŒ…å’Œæäº¤å®¡æ ¸ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸æ¨èçš„ï¼Œéœ€è¦æˆ‘ä»¬å»åšï¼š

{% highlight css %}
Dear Developer,
We identified one or more issues with a recent delivery for your app, "XXXX". Your delivery was successful, but you may wish to correct the following issues in your next delivery:
Invalid Siri SupportÂ - Localized title for custom intent: "XXX" not found for locale: zh-hant
Invalid Siri SupportÂ - Localized title for custom intent: "XXX" not found for locale: zh-hans
...
After youâ€™ve corrected the issues, you can use Xcode or Application Loader to upload a new binary to iTunes Connect.
Best regards,
The App Store Team
{% endhighlight %}

è¿™ç©æ„ç ”ç©¶åŠå¤©ï¼Œå®éªŒäº†å‡ æ¬¡æ‰“åŒ…æ‰æ²¡æœ‰äº†è¿™ç§é‚®ä»¶è­¦å‘Š=ã€‚=ï¼Œå…·ä½“çš„åšæ³•æ˜¯åœ¨å³è¾¹ç¼–è¾‘é¢æ¿è¿™é‡Œé€‰æ‹©æœ¬åœ°åŒ–æŒ‰é’®ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/14.png"><img src="{{ site.url }}/images/SiriShortcut/14.png"></a>
</figure>

ç„¶åé€‰æ‹©ä½ çš„å·¥ç¨‹å†…çš„ä¸»è¯­è¨€ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/15.png"><img src="{{ site.url }}/images/SiriShortcut/15.png"></a>
</figure>

ç„¶ååœ¨å³è¾¹é¢æ¿å†…ç»§ç»­å‹¾ä¸Šå·¥ç¨‹æ‰€éœ€è¦æœ¬åœ°åŒ–çš„è¯­è¨€ï¼Œæ¯”å¦‚ç²¤è¯­ç­‰ï¼Œæœ€åæˆ‘ä»¬ä¼šçœ‹åˆ°åŸæ¥çš„`intentdefinition`æ–‡ä»¶å·¦è¾¹å¤šäº†ä¸€ä¸ªç®­å¤´ï¼Œå¯ä»¥æ‰“å¼€çœ‹åˆ°å¢åŠ çš„æœ¬åœ°åŒ–è¯­è¨€ï¼š

{% highlight css %}
"NWKE91" = "çœ‹è®°å½•çœ‹è®°å½•";
"ajUMDz" = "å“ˆå“ˆå“ˆå•Šå“ˆ";
{% endhighlight %}

å·¦è¾¹æˆ‘çš„ç†è§£æ˜¯ä¸€ä¸ªå”¯ä¸€æ ‡ç¤ºå§ï¼Œå³è¾¹æ˜¯ç›¸åº”è¯­è¨€çš„æœ¬åœ°åŒ–æ–‡å­—ã€‚

##### (3): Watchæ–°iconçš„æ·»åŠ 

æœ€è¿‘çš„å‡ æ¬¡æäº¤ä¼šæ”¶åˆ°ä¸€å°é‚®ä»¶ï¼Œå¤§è‡´ä¸Šæ˜¯è¯´`Watch App`ç¼ºå°‘`watch series4`çš„iconï¼Œæˆ‘ä»¬ç¼ºå°‘çš„æ˜¯è¿™ä¸¤ä¸ª
* 50 * 50
* 108 * 108

##### (4)å°æ’æ›²:å°è¯•ä¿®å¤Xcode10æ‰“åŒ…å‡ºæ¥çš„åœ¨iOS9.0-9.2å´©æºƒçš„é—®é¢˜ï¼š
æ ¸å¿ƒæ–¹æ³•ï¼š

> ln -s  Xcode9çš„ibtooldè·¯å¾„    Xcode10çš„ibtooldè·¯å¾„

0.éœ€è¦åŒæ—¶å®‰è£…Xcode9å’ŒXcode10.

1.å®šä½åˆ°Xcode10 ibtoold è·¯å¾„ä¸‹ æŠŠè¿™ä¸ªæ–‡ä»¶éšä¾¿æ”¹ä¸ªåå­—ä¾‹å¦‚
ibtoold.bat

2.Xcode10 ibtoold è·¯å¾„ï¼š/Users/JerryLiu/Downloads/Xcode.app/Contents/Developer/usr/bin/ibtoold

3.Xcode9 ibtoold è·¯å¾„:/Users/JerryLiu/Downloads/Xcode\2.app/Contents/Developer/usr/bin/ibtoold

4.æ‰§è¡Œï¼š`ln -s  Xcode9çš„ibtooldè·¯å¾„    Xcode10çš„ibtooldè·¯å¾„`
ln -s /Users/JerryLiu/Downloads/Xcode\2.app/Contents/Developer/usr/bin/ibtoold /Users/JerryLiu/Downloads/Xcode.app/Contents/Developer/usr/bin/ibtoold

5.å¦‚æœä»£è¡¨æ­£ç¡®è®¾ç½®äº†ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/16.png"><img src="{{ site.url }}/images/SiriShortcut/16.png"></a>
</figure>

6.æ³¨æ„çš„æ˜¯ï¼Œæ— æ³•å°†Xcode10 å…³äºiOS12ã€watchOS5ç­‰æ–°SDKçš„UI(é€šè¿‡storyboardæ·»åŠ çš„UI:ä¾‹å¦‚nowplayingView)æ‰“åŒ…æˆåŠŸï¼Œéœ€è¦èˆå¼ƒã€‚
ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯:
<figure>
<a href="{{ site.url }}/images/SiriShortcut/17.png"><img src="{{ site.url }}/images/SiriShortcut/17.png"></a>
</figure>

#### **6.å°ç»“**

å…¶å®å‚ä¸è¿‡é€‚é…æˆ–è€…ï¼Œæ–°`Feature`è°ƒç ”å¼€å‘çš„åŒå­¦éƒ½åº”è¯¥çŸ¥é“è¿™æ¡è·¯å°±æ˜¯ä¸€æ¡å¾ˆå¯‚å¯çš„é“è·¯ï¼Œå‰æœŸèµ„æºå¤ªå°‘ï¼Œè€Œæ°æ°è¿™ä¸ªæ—¶å€™è‹¹æœçˆ¸çˆ¸é‚£é‡Œçš„å·¥å…·åˆä¸æ˜¯å¾ˆç¨³å®šï¼Œä»ä¸‹é¢å›¾å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œ`iOS12`ç»å†äº†å¤šå°‘ç£¨éš¾æ–¹æ‰å’Œå¤§å®¶è§é¢ï¼š
<figure>
<a href="{{ site.url }}/images/SiriShortcut/18.png"><img src="{{ site.url }}/images/SiriShortcut/18.png"></a>
</figure>

åˆ«çœ‹Xcode10 æ‰å‡ºåˆ°beta 6ï¼Œä½†æ˜¯è®²é“ç†å°½ç®¡æ˜¯åˆ°äº†`GM`ç‰ˆæœ¬ï¼Œä¾ç„¶å­˜åœ¨é—®é¢˜æ˜¯ä¸äº‰çš„äº‹å®ï¼Œç”šè‡³æ˜¯åŒ…æ‹¬è‡´å‘½çš„`iOS9`å´©æºƒé—®é¢˜ï¼Œè¦çŸ¥é“åœ¨å›½å†…ï¼Œä½ç‰ˆæœ¬ä¸å‡çº§çš„`iOS`ç³»ç»Ÿè¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ ¹æœ¬å°±ä¸å¯èƒ½èˆå¼ƒè¿™ä¸€éƒ¨åˆ†çš„ç”¨æˆ·ã€‚

å¦ä¸€æ–¹é¢ï¼Œè¯¸å¦‚`Siri Shortcut`çš„æ–°åŠŸèƒ½çš„é€‚é…ä»¿ä½›å¤§å®¶éƒ½æ¯”è¾ƒæ»åï¼Œæˆ–è€…è¯´å…¶å®å¾ˆå¤šäººé‡åˆ°äº†å’Œæˆ‘ä¸€æ ·çš„é—®é¢˜ï¼Œåªæ˜¯æ²¡æœ‰å¬åˆ°è¿‡æˆ–è€…æŸ¥åˆ°è¿‡ï¼Œæˆ‘å°è±¡ä¸­æ¯”è¾ƒæ·±çš„æ˜¯ï¼Œç¬¬äºŒå¤©`iOS12`å°±è¦é‡Šæ”¾äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘å´å‘ç°äº†ä¸€ä¸ªbugï¼Œå¹¶æäº¤äº†Radar,é‚£è¿™ä¹ˆè¯´ï¼Œæˆ‘é‡åˆ°çš„å·²ç»ç®—æ¯”è¾ƒæ™šçš„äº†ï¼Œç«Ÿç„¶æ²¡æœ‰è¢«ä¿®å¤æˆ–è€…ä¼˜åŒ–ã€‚

è¿™æ˜¯ä»¥ä¸Šç§ç§ï¼Œéƒ½ä¸èƒ½å»å¿½è§†`Siri`çš„è¶Šæ¥è¶Šå¼ºå¤§ï¼Œæˆ‘ä¹Ÿç›¸ä¿¡éšç€çœŸæ­£çš„ç”¨æˆ·è§’åº¦çš„`Intent`è¶Šæ¥è¶Šå¤šï¼Œä½¿ç”¨`Siri`æ¥æ–¹ä¾¿è‡ªå·±ç”Ÿæ´»çš„äººä¼šè¶Šæ¥è¶Šå¤šï¼ŒAppä¹Ÿä¼šæ›´åŠ çš„å¼ºå£®ã€‚ğŸ’ª å°±è¿™ä¹ˆå¤šå§ï¼Œåº”è¯¥è¿˜ä¼šæœ‰ä¸€äº›é€‚é…çš„ç»†èŠ‚å¿˜è®°äº†æ²¡æœ‰è¯´ï¼Œå¦‚æœæƒ³èµ·æ¥äº†ï¼Œå†å›æ¥è¡¥å……ï¼Œä¹Ÿç¥å¤§å®¶é€‚é…é¡ºåˆ©~æ—©æ—¥ä¸Šçº¿ï¼
